<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>What React Refs Really Are</title>
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/highlight.js@10.1.1/styles/atom-one-dark.css" />
  <style>
    @media not print {
      a { color: deepskyblue; }

      body {
        background-color: black;
        color: whitesmoke;
      }

      .hljs-comment {
        color: gray;
      }
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif;
      font-size: 1.125rem;
    }

    pre { font-size: 1rem }
  </style>
</head>

<body class="lh-copy">

<div class="ph4-ns mw7 center-ns">
  <header>
    <h2>Andrew Huth</h2>
    <nav>
  <ul class="list pl0">
    <li class="dib pr1"><a href="https://ahuth.github.io">Home</a></li>
    <li class="dib ph1"><a href="https://ahuth.github.io/articles">Articles</a></li>
  </ul>
</nav>

  </header>
  <main>
    <article>
      <header>
        <h1>What React Refs Really Are</h1>
        <time datetime="2020-01-11">2020-01-11</time>
      </header>
      <div>
        <p>Before <a href="https://reactjs.org/docs/hooks-overview.html">hooks</a>, React refs were used to capture references to DOM nodes, so that we can interact with their APIs.</p>
<pre><code class="language-jsx"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  canvasRef = React.createRef();

  <span class="hljs-function"><span class="hljs-title">componentDidMount</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">const</span> canvas = <span class="hljs-built_in">this</span>.canvasRef.current;
    <span class="hljs-comment">// Do things with the canvas element...</span>
  }

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{canvasRef}</span> /&gt;</span></span>;
  }
}
</code></pre>
<p>There weren't really any other use cases. But that changed with hooks.</p>
<p>When using hooks, there are many times we have to explicitly consider what values are changing, and how this affects setup and teardown.</p>
<p>For example, this logs a message to the console every so often.</p>
<pre><code class="language-jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyComponent</span>(<span class="hljs-params">{ message, interval }</span>) </span>{
  React.useEffect(
    <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(message);
      }, interval);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(id);
    },
    [message, interval],
  );

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> /&gt;</span></span>;
}
</code></pre>
<p>Any time the message or interval changes, the <code>setInterval</code> is cleared and a new one is setup. Often this is exactly what we want. But in this case we don't necessarily need to tear down and re-setup anytime the <code>message</code> changes. And for more complex  examples, it may be much better to avoid this. We want an immutable reference to a mutable value.</p>
<p>And this is exactly what refs now help us with.</p>
<pre><code class="language-jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyComponent</span>(<span class="hljs-params">{ message, interval }</span>) </span>{
  <span class="hljs-keyword">const</span> messageRef = useRef(message);

  <span class="hljs-comment">// Keep a ref updated with the latest `message`.</span>
  React.useEffect(
    <span class="hljs-function">() =&gt;</span> {
      messageRef.current = message;
    },
    [message],
  );

  <span class="hljs-comment">// And reference the `current` property of the ref</span>
  <span class="hljs-comment">// here.</span>
  React.useEffect(
    <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(messageRef.current);
      });

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(id);
    },
    [messageRef, interval],
  )

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> /&gt;</span></span>;
}
</code></pre>
<p>For this example, the <code>messageRef</code> object will never change, and will not cause the second <code>useEffect</code> call to clear the interval and set a new one up.</p>
<p>This is what React refs &quot;really&quot; are: immutable references to mutable values, which are helpful to control when other hooks re-compute themselves.</p>

      </div>
      <footer>
        <hr />
        <p>Have thoughts on this? Let me know at <a href="mailto:andrew@huth.me">andrew@huth.me</a>.</p>
      </footer>
    </article>
  </main>
</div>


</body>

</html>
